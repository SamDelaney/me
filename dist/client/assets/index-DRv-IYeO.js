import{r as O,j as b}from"./main-Xj2qM_Gs.js";var it=1e-6,R=typeof Float32Array<"u"?Float32Array:Array;function rt(){var t=new R(9);return R!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function I(){var t=new R(16);return R!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function nt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function st(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],m=e[11],x=e[12],v=e[13],p=e[14],E=e[15],T=i*o-r*a,_=i*c-n*a,u=i*h-s*a,A=r*c-n*o,g=r*h-s*o,U=n*h-s*c,z=l*v-f*x,V=l*p-d*x,N=l*E-m*x,C=f*p-d*v,L=f*E-m*v,B=d*E-m*p,P=T*B-_*L+u*C+A*N-g*V+U*z;return P?(P=1/P,t[0]=(o*B-c*L+h*C)*P,t[1]=(n*L-r*B-s*C)*P,t[2]=(v*U-p*g+E*A)*P,t[3]=(d*g-f*U-m*A)*P,t[4]=(c*N-a*B-h*V)*P,t[5]=(i*B-n*N+s*V)*P,t[6]=(p*u-x*U-E*_)*P,t[7]=(l*U-d*u+m*_)*P,t[8]=(a*L-o*N+h*z)*P,t[9]=(r*N-i*L-s*z)*P,t[10]=(x*g-v*u+E*T)*P,t[11]=(f*u-l*g-m*T)*P,t[12]=(o*V-a*C-c*z)*P,t[13]=(i*C-r*V+n*z)*P,t[14]=(v*_-x*A-p*T)*P,t[15]=(l*A-f*_+d*T)*P,t):null}function Y(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],o=e[4],c=e[5],h=e[6],l=e[7],f=e[8],d=e[9],m=e[10],x=e[11],v=e[12],p=e[13],E=e[14],T=e[15],_=i[0],u=i[1],A=i[2],g=i[3];return t[0]=_*r+u*o+A*f+g*v,t[1]=_*n+u*c+A*d+g*p,t[2]=_*s+u*h+A*m+g*E,t[3]=_*a+u*l+A*x+g*T,_=i[4],u=i[5],A=i[6],g=i[7],t[4]=_*r+u*o+A*f+g*v,t[5]=_*n+u*c+A*d+g*p,t[6]=_*s+u*h+A*m+g*E,t[7]=_*a+u*l+A*x+g*T,_=i[8],u=i[9],A=i[10],g=i[11],t[8]=_*r+u*o+A*f+g*v,t[9]=_*n+u*c+A*d+g*p,t[10]=_*s+u*h+A*m+g*E,t[11]=_*a+u*l+A*x+g*T,_=i[12],u=i[13],A=i[14],g=i[15],t[12]=_*r+u*o+A*f+g*v,t[13]=_*n+u*c+A*d+g*p,t[14]=_*s+u*h+A*m+g*E,t[15]=_*a+u*l+A*x+g*T,t}function H(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function at(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ot(t,e,i,r,n){var s=1/Math.tan(e/2);if(t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){var a=1/(r-n);t[10]=(n+r)*a,t[14]=2*n*r*a}else t[10]=-1,t[14]=-2*r;return t}var ct=ot;function Q(t,e,i,r){var n=e[0],s=e[1],a=e[2],o=r[0],c=r[1],h=r[2],l=n-i[0],f=s-i[1],d=a-i[2],m=l*l+f*f+d*d;m>0&&(m=1/Math.sqrt(m),l*=m,f*=m,d*=m);var x=c*d-h*f,v=h*l-o*d,p=o*f-c*l;return m=x*x+v*v+p*p,m>0&&(m=1/Math.sqrt(m),x*=m,v*=m,p*=m),t[0]=x,t[1]=v,t[2]=p,t[3]=0,t[4]=f*p-d*v,t[5]=d*x-l*p,t[6]=l*v-f*x,t[7]=0,t[8]=l,t[9]=f,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function M(){var t=new R(3);return R!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function lt(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function w(t,e,i){var r=new R(3);return r[0]=t,r[1]=e,r[2]=i,r}function ht(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ft(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function dt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function D(t,e){var i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function X(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function W(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],o=i[1],c=i[2];return t[0]=n*c-s*o,t[1]=s*a-r*c,t[2]=r*o-n*a,t}function k(t,e,i){var r=i[0],n=i[1],s=i[2],a=i[3],o=e[0],c=e[1],h=e[2],l=n*h-s*c,f=s*o-r*h,d=r*c-n*o;return l=l+l,f=f+f,d=d+d,t[0]=o+a*l+n*d-s*f,t[1]=c+a*f+s*l-r*d,t[2]=h+a*d+r*f-n*l,t}var mt=lt;(function(){var t=M();return function(e,i,r,n,s,a){var o,c;for(i||(i=3),r||(r=0),n?c=Math.min(n*i+r,e.length):c=e.length,o=r;o<c;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function xt(){var t=new R(4);return R!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function vt(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=s*a,t}(function(){var t=xt();return function(e,i,r,n,s,a){var o,c;for(i||(i=4),r||(r=0),n?c=Math.min(n*i+r,e.length):c=e.length,o=r;o<c;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function y(){var t=new R(4);return R!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function tt(t,e,i){i=i*.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function K(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],o=i[0],c=i[1],h=i[2],l=i[3];return t[0]=r*l+a*o+n*h-s*c,t[1]=n*l+a*c+s*o-r*h,t[2]=s*l+a*h+r*c-n*o,t[3]=a*l-r*o-n*c-s*h,t}function F(t,e,i,r){var n=e[0],s=e[1],a=e[2],o=e[3],c=i[0],h=i[1],l=i[2],f=i[3],d,m,x,v,p;return m=n*c+s*h+a*l+o*f,m<0&&(m=-m,c=-c,h=-h,l=-l,f=-f),1-m>it?(d=Math.acos(m),x=Math.sin(d),v=Math.sin((1-r)*d)/x,p=Math.sin(r*d)/x):(v=1-r,p=r),t[0]=v*n+p*c,t[1]=v*s+p*h,t[2]=v*a+p*l,t[3]=v*o+p*f,t}function pt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function _t(t,e){var i=e[0]+e[4]+e[8],r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[s*3+s]-e[a*3+a]+1),t[n]=.5*r,r=.5/r,t[3]=(e[s*3+a]-e[a*3+s])*r,t[s]=(e[s*3+n]+e[n*3+s])*r,t[a]=(e[a*3+n]+e[n*3+a])*r}return t}var j=vt;(function(){var t=M(),e=w(1,0,0),i=w(0,1,0);return function(r,n,s){var a=X(n,s);return a<-.999999?(W(t,e,n),mt(t)<1e-6&&W(t,i,n),D(t,t),tt(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(W(t,n,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,j(r,r))}})();(function(){var t=y(),e=y();return function(i,r,n,s,a,o){return F(t,r,a,o),F(e,n,s,o),F(i,t,e,2*o*(1-o)),i}})();(function(){var t=rt();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],j(e,_t(e,t))}})();function S(){var t=new R(2);return R!=Float32Array&&(t[0]=0,t[1]=0),t}function ut(t){var e=new R(2);return e[0]=t[0],e[1]=t[1],e}function Z(t,e){return t[0]=e[0],t[1]=e[1],t}function q(t,e,i){return t[0]=e,t[1]=i,t}function At(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function gt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Pt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Et(t){var e=t[0],i=t[1];return e*e+i*i}var Rt=gt,Tt=Et;(function(){var t=S();return function(e,i,r,n,s,a){var o,c;for(i||(i=2),r||(r=0),n?c=Math.min(n*i+r,e.length):c=e.length,o=r;o<c;o+=i)t[0]=e[o],t[1]=e[o+1],s(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}})();const Mt=`#version 300 es

uniform mat4 uWorldMatrix;
uniform mat4 uViewMatrix;
uniform mat4 uProjectionMatrix;
uniform vec3 uCameraPosition;
uniform vec4 uRotationAxisVelocity;

in vec3 aModelPosition;
in vec3 aModelNormal;
in vec2 aModelUvs;
in mat4 aInstanceMatrix;

out vec2 vUvs;
out float vAlpha;
flat out int vInstanceId;

#define PI 3.141593

void main() {
    vec4 worldPosition = uWorldMatrix * aInstanceMatrix * vec4(aModelPosition, 1.);

    vec3 centerPos = (uWorldMatrix * aInstanceMatrix * vec4(0., 0., 0., 1.)).xyz;
    float radius = length(centerPos.xyz);

    if (gl_VertexID > 0) {
        vec3 rotationAxis = uRotationAxisVelocity.xyz;
        float rotationVelocity = min(.15, uRotationAxisVelocity.w * 15.);
        vec3 stretchDir = normalize(cross(centerPos, rotationAxis));
        vec3 relativeVertexPos = normalize(worldPosition.xyz - centerPos);
        float strength = dot(stretchDir, relativeVertexPos);
        float invAbsStrength = min(0., abs(strength) - 1.);
        strength = rotationVelocity * sign(strength) * abs(invAbsStrength * invAbsStrength * invAbsStrength + 1.);
        worldPosition.xyz += stretchDir * strength;
    }

    worldPosition.xyz = radius * normalize(worldPosition.xyz);

    gl_Position = uProjectionMatrix * uViewMatrix * worldPosition;

    vAlpha = smoothstep(0.5, 1., normalize(worldPosition.xyz).z) * .9 + .1;
    vUvs = aModelUvs;
    vInstanceId = gl_InstanceID;
}
`,It=`#version 300 es
precision highp float;

uniform sampler2D uTex;
uniform int uItemCount;
uniform int uAtlasSize;

out vec4 outColor;

in vec2 vUvs;
in float vAlpha;
flat in int vInstanceId;

void main() {
    int itemIndex = vInstanceId % uItemCount;
    int cellsPerRow = uAtlasSize;
    int cellX = itemIndex % cellsPerRow;
    int cellY = itemIndex / cellsPerRow;
    vec2 cellSize = vec2(1.0) / vec2(float(cellsPerRow));
    vec2 cellOffset = vec2(float(cellX), float(cellY)) * cellSize;

    ivec2 texSize = textureSize(uTex, 0);
    float imageAspect = float(texSize.x) / float(texSize.y);
    float containerAspect = 1.0;
    
    float scale = max(imageAspect / containerAspect, 
                     containerAspect / imageAspect);
    
    vec2 st = vec2(vUvs.x, 1.0 - vUvs.y);
    st = (st - 0.5) * scale + 0.5;
    
    st = clamp(st, 0.0, 1.0);
    st = st * cellSize + cellOffset;
    
    outColor = texture(uTex, st);
    outColor.a *= vAlpha;
}
`;class G{a;b;c;constructor(e,i,r){this.a=e,this.b=i,this.c=r}}class bt{position;normal;uv;constructor(e,i,r){this.position=w(e,i,r),this.normal=M(),this.uv=S()}}class et{vertices;faces;constructor(){this.vertices=[],this.faces=[]}addVertex(...e){for(let i=0;i<e.length;i+=3)this.vertices.push(new bt(e[i],e[i+1],e[i+2]));return this}addFace(...e){for(let i=0;i<e.length;i+=3)this.faces.push(new G(e[i],e[i+1],e[i+2]));return this}get lastVertex(){return this.vertices[this.vertices.length-1]}subdivide(e=1){const i={};let r=this.faces;for(let n=0;n<e;++n){const s=new Array(r.length*4);r.forEach((a,o)=>{const c=this.getMidPoint(a.a,a.b,i),h=this.getMidPoint(a.b,a.c,i),l=this.getMidPoint(a.c,a.a,i),f=o*4;s[f+0]=new G(a.a,c,l),s[f+1]=new G(a.b,h,c),s[f+2]=new G(a.c,l,h),s[f+3]=new G(c,h,l)}),r=s}return this.faces=r,this}spherize(e=1){return this.vertices.forEach(i=>{D(i.normal,i.position),ht(i.position,i.normal,e)}),this}get data(){return{vertices:this.vertexData,indices:this.indexData,normals:this.normalData,uvs:this.uvData}}get vertexData(){return new Float32Array(this.vertices.flatMap(e=>Array.from(e.position)))}get normalData(){return new Float32Array(this.vertices.flatMap(e=>Array.from(e.normal)))}get uvData(){return new Float32Array(this.vertices.flatMap(e=>Array.from(e.uv)))}get indexData(){return new Uint16Array(this.faces.flatMap(e=>[e.a,e.b,e.c]))}getMidPoint(e,i,r){const n=e<i?`k_${i}_${e}`:`k_${e}_${i}`;if(Object.prototype.hasOwnProperty.call(r,n))return r[n];const s=this.vertices[e].position,a=this.vertices[i].position,o=this.vertices.length;return r[n]=o,this.addVertex((s[0]+a[0])*.5,(s[1]+a[1])*.5,(s[2]+a[2])*.5),o}}class yt extends et{constructor(){super();const e=Math.sqrt(5)*.5+.5;this.addVertex(-1,e,0,1,e,0,-1,-e,0,1,-e,0,0,-1,e,0,1,e,0,-1,-e,0,1,-e,e,0,-1,e,0,1,-e,0,-1,-e,0,1).addFace(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1)}}class wt extends et{constructor(e=4,i=1){super();const r=Math.max(4,e),n=2*Math.PI/r;this.addVertex(0,0,0),this.lastVertex.uv[0]=.5,this.lastVertex.uv[1]=.5;for(let s=0;s<r;++s){const a=Math.cos(n*s),o=Math.sin(n*s);this.addVertex(i*a,i*o,0),this.lastVertex.uv[0]=a*.5+.5,this.lastVertex.uv[1]=o*.5+.5,s>0&&this.addFace(0,s,s+1)}this.addFace(0,r,1)}}function St(t,e,i){const r=t.createShader(e);return r?(t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),t.deleteShader(r),null)):null}function Dt(t,e,i,r){const n=t.createProgram();if(!n)return null;if([t.VERTEX_SHADER,t.FRAGMENT_SHADER].forEach((a,o)=>{const c=St(t,a,e[o]);c&&t.attachShader(n,c)}),r)for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.bindAttribLocation(n,r[a],a);return t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?n:(console.error(t.getProgramInfoLog(n)),t.deleteProgram(n),null)}function Ft(t,e,i){const r=t.createVertexArray();if(!r)return null;t.bindVertexArray(r);for(const[n,s,a]of e)s!==-1&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,a,t.FLOAT,!1,0,0));if(i){const n=t.createBuffer();n&&(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW))}return t.bindVertexArray(null),r}function Ut(t){const e=Math.min(2,window.devicePixelRatio||1),i=Math.round(t.clientWidth*e),r=Math.round(t.clientHeight*e),n=t.width!==i||t.height!==r;return n&&(t.width=i,t.height=r),n}function J(t,e,i){const r=t.createBuffer();if(!r)throw new Error("Failed to create WebGL buffer.");return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e,i),t.bindBuffer(t.ARRAY_BUFFER,null),r}function zt(t,e,i,r,n){const s=t.createTexture();if(!s)throw new Error("Failed to create WebGL texture.");return t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),s}class Vt{canvas;updateCallback;isPointerDown=!1;orientation=y();pointerRotation=y();rotationVelocity=0;rotationAxis=w(1,0,0);snapDirection=w(0,0,-1);snapTargetDirection=null;pointerPos=S();previousPointerPos=S();_rotationVelocity=0;_combinedQuat=y();EPSILON=.1;IDENTITY_QUAT=y();constructor(e,i){this.canvas=e,this.updateCallback=i||(()=>{}),e.addEventListener("pointerdown",r=>{q(this.pointerPos,r.clientX,r.clientY),Z(this.previousPointerPos,this.pointerPos),this.isPointerDown=!0}),e.addEventListener("pointerup",()=>{this.isPointerDown=!1}),e.addEventListener("pointerleave",()=>{this.isPointerDown=!1}),e.addEventListener("pointermove",r=>{this.isPointerDown&&q(this.pointerPos,r.clientX,r.clientY)}),e.style.touchAction="none"}update(e,i=16){const r=e/i+1e-5;let n=r;const s=y();if(this.isPointerDown){const d=.3*r,m=5/r,x=Rt(S(),this.pointerPos,this.previousPointerPos);if(Pt(x,x,d),Tt(x)>this.EPSILON){At(x,this.previousPointerPos,x);const v=this.project(x),p=this.project(this.previousPointerPos),E=D(M(),v),T=D(M(),p);Z(this.previousPointerPos,x),n*=m,this.quatFromVectors(E,T,this.pointerRotation,n)}else F(this.pointerRotation,this.pointerRotation,this.IDENTITY_QUAT,d)}else{const d=.1*r;if(F(this.pointerRotation,this.pointerRotation,this.IDENTITY_QUAT,d),this.snapTargetDirection){const x=this.snapTargetDirection,v=this.snapDirection,p=ft(x,v),E=Math.max(.1,1-p*10);n*=.2*E,this.quatFromVectors(x,v,s,n)}}const a=K(y(),s,this.pointerRotation);this.orientation=K(y(),a,this.orientation),j(this.orientation,this.orientation);const o=.8*r;F(this._combinedQuat,this._combinedQuat,a,o),j(this._combinedQuat,this._combinedQuat);const c=Math.acos(this._combinedQuat[3])*2,h=Math.sin(c/2);let l=0;h>1e-6&&(l=c/(2*Math.PI),this.rotationAxis[0]=this._combinedQuat[0]/h,this.rotationAxis[1]=this._combinedQuat[1]/h,this.rotationAxis[2]=this._combinedQuat[2]/h);const f=.5*r;this._rotationVelocity+=(l-this._rotationVelocity)*f,this.rotationVelocity=this._rotationVelocity/r,this.updateCallback(e)}quatFromVectors(e,i,r,n=1){const s=W(M(),e,i);D(s,s);const a=Math.max(-1,Math.min(1,X(e,i))),o=Math.acos(a)*n;return tt(r,s,o),{q:r,axis:s,angle:o}}project(e){const r=this.canvas.clientWidth,n=this.canvas.clientHeight,s=Math.max(r,n)-1,a=(2*e[0]-r-1)/s,o=(2*e[1]-n-1)/s;let c=0;const h=a*a+o*o,l=4;return h<=l/2?c=Math.sqrt(l-h):c=l/Math.sqrt(h),w(-a,o,c)}}class Nt{constructor(e,i,r,n,s){this.canvas=e,this.items=i,this.onActiveItemChange=r,this.onMovementChange=n,this.init(s)}gl=null;discProgram=null;discVAO=null;discBuffers;icoGeo;discGeo;worldMatrix=I();tex=null;control;discLocations;viewportSize=S();drawBufferSize=S();discInstances;instancePositions=[];DISC_INSTANCE_COUNT=0;atlasSize=1;_time=0;_deltaTime=0;_deltaFrames=0;_frames=0;movementActive=!1;TARGET_FRAME_DURATION=1e3/60;SPHERE_RADIUS=2;camera={matrix:I(),near:.1,far:40,fov:Math.PI/4,aspect:1,position:w(0,0,3),up:w(0,1,0),matrices:{view:I(),projection:I(),inversProjection:I()}};smoothRotationVelocity=0;scaleFactor=1;resize(){const e=Ut(this.canvas);this.gl&&(e&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.updateProjectionMatrix())}run(e=0){this._deltaTime=Math.min(32,e-this._time),this._time=e,this._deltaFrames=this._deltaTime/this.TARGET_FRAME_DURATION,this._frames+=this._deltaFrames,this.animate(this._deltaTime),this.render(),requestAnimationFrame(i=>this.run(i))}init(e){const i=this.canvas.getContext("webgl2",{antialias:!0,alpha:!1});if(!i)throw new Error("No WebGL 2 context!");this.gl=i,q(this.viewportSize,this.canvas.clientWidth,this.canvas.clientHeight),ut(this.drawBufferSize),this.discProgram=Dt(i,[Mt,It],null,{aModelPosition:0,aModelNormal:1,aModelUvs:2,aInstanceMatrix:3}),this.discLocations={aModelPosition:i.getAttribLocation(this.discProgram,"aModelPosition"),aModelUvs:i.getAttribLocation(this.discProgram,"aModelUvs"),aInstanceMatrix:i.getAttribLocation(this.discProgram,"aInstanceMatrix"),uWorldMatrix:i.getUniformLocation(this.discProgram,"uWorldMatrix"),uViewMatrix:i.getUniformLocation(this.discProgram,"uViewMatrix"),uProjectionMatrix:i.getUniformLocation(this.discProgram,"uProjectionMatrix"),uCameraPosition:i.getUniformLocation(this.discProgram,"uCameraPosition"),uScaleFactor:i.getUniformLocation(this.discProgram,"uScaleFactor"),uRotationAxisVelocity:i.getUniformLocation(this.discProgram,"uRotationAxisVelocity"),uTex:i.getUniformLocation(this.discProgram,"uTex"),uFrames:i.getUniformLocation(this.discProgram,"uFrames"),uItemCount:i.getUniformLocation(this.discProgram,"uItemCount"),uAtlasSize:i.getUniformLocation(this.discProgram,"uAtlasSize")},this.discGeo=new wt(56,1),this.discBuffers=this.discGeo.data,this.discVAO=Ft(i,[[J(i,this.discBuffers.vertices,i.STATIC_DRAW),this.discLocations.aModelPosition,3],[J(i,this.discBuffers.uvs,i.STATIC_DRAW),this.discLocations.aModelUvs,2]],this.discBuffers.indices),this.icoGeo=new yt,this.icoGeo.subdivide(1).spherize(this.SPHERE_RADIUS),this.instancePositions=this.icoGeo.vertices.map(r=>r.position),this.DISC_INSTANCE_COUNT=this.icoGeo.vertices.length,this.initDiscInstances(this.DISC_INSTANCE_COUNT),this.initTexture(),this.control=new Vt(this.canvas,r=>this.onControlUpdate(r)),this.updateCameraMatrix(),this.updateProjectionMatrix(),this.resize(),e&&e(this)}initTexture(){if(!this.gl)return;const e=this.gl;this.tex=zt(e,e.LINEAR,e.LINEAR,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE);const i=Math.max(1,this.items.length);this.atlasSize=Math.ceil(Math.sqrt(i));const r=512,n=document.createElement("canvas"),s=n.getContext("2d");n.width=this.atlasSize*r,n.height=this.atlasSize*r,s.fillStyle="#333333",s.fillRect(0,0,n.width,n.height),Promise.all(this.items.map(a=>new Promise(o=>{const c=new Image;a.image.startsWith("http")&&(c.crossOrigin="anonymous"),c.onload=()=>o(c),c.onerror=h=>{console.warn(`Failed to load image: ${a.image}`,h);const l=document.createElement("canvas");l.width=r,l.height=r;const f=l.getContext("2d"),d=f.createRadialGradient(r/2,r/2,0,r/2,r/2,r/2);d.addColorStop(0,"#4CAF50"),d.addColorStop(1,"#2E7D32"),f.fillStyle=d,f.fillRect(0,0,r,r),a.title&&(f.fillStyle="white",f.font="24px Arial",f.textAlign="center",f.fillText(a.title,r/2,r/2));const m=new Image;m.onload=()=>o(m),m.src=l.toDataURL()},c.src=a.image}))).then(a=>{a.forEach((o,c)=>{const h=c%this.atlasSize*r,l=Math.floor(c/this.atlasSize)*r;s.drawImage(o,h,l,r,r)}),e.bindTexture(e.TEXTURE_2D,this.tex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D)}).catch(a=>{console.error("Error loading textures:",a),e.bindTexture(e.TEXTURE_2D,this.tex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D)})}initDiscInstances(e){if(!this.gl||!this.discVAO)return;const i=this.gl,r=new Float32Array(e*16),n=[];for(let o=0;o<e;++o){const c=new Float32Array(r.buffer,o*16*4,16);st(c),n.push(c)}this.discInstances={matricesArray:r,matrices:n,buffer:i.createBuffer()},i.bindVertexArray(this.discVAO),i.bindBuffer(i.ARRAY_BUFFER,this.discInstances.buffer),i.bufferData(i.ARRAY_BUFFER,this.discInstances.matricesArray.byteLength,i.DYNAMIC_DRAW);const s=4,a=64;for(let o=0;o<s;++o){const c=this.discLocations.aInstanceMatrix+o;i.enableVertexAttribArray(c),i.vertexAttribPointer(c,4,i.FLOAT,!1,a,o*4*4),i.vertexAttribDivisor(c,1)}i.bindBuffer(i.ARRAY_BUFFER,null),i.bindVertexArray(null)}animate(e){if(!this.gl)return;this.control.update(e,this.TARGET_FRAME_DURATION);const i=this.instancePositions.map(s=>k(M(),s,this.control.orientation)),r=.25,n=.6;i.forEach((s,a)=>{const c=(Math.abs(s[2])/this.SPHERE_RADIUS*n+(1-n))*r,h=I();Y(h,h,H(I(),dt(M(),s))),Y(h,h,Q(I(),[0,0,0],s,[0,1,0])),Y(h,h,at(I(),[c,c,c])),Y(h,h,H(I(),[0,0,-this.SPHERE_RADIUS])),nt(this.discInstances.matrices[a],h)}),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.discInstances.buffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.discInstances.matricesArray),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.smoothRotationVelocity=this.control.rotationVelocity}render(){if(!this.gl||!this.discProgram)return;const e=this.gl;e.useProgram(this.discProgram),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.uniformMatrix4fv(this.discLocations.uWorldMatrix,!1,this.worldMatrix),e.uniformMatrix4fv(this.discLocations.uViewMatrix,!1,this.camera.matrices.view),e.uniformMatrix4fv(this.discLocations.uProjectionMatrix,!1,this.camera.matrices.projection),e.uniform3f(this.discLocations.uCameraPosition,this.camera.position[0],this.camera.position[1],this.camera.position[2]),e.uniform4f(this.discLocations.uRotationAxisVelocity,this.control.rotationAxis[0],this.control.rotationAxis[1],this.control.rotationAxis[2],this.smoothRotationVelocity*1.1),e.uniform1i(this.discLocations.uItemCount,this.items.length),e.uniform1i(this.discLocations.uAtlasSize,this.atlasSize),e.uniform1f(this.discLocations.uFrames,this._frames),e.uniform1f(this.discLocations.uScaleFactor,this.scaleFactor),e.uniform1i(this.discLocations.uTex,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.tex),e.bindVertexArray(this.discVAO),e.drawElementsInstanced(e.TRIANGLES,this.discBuffers.indices.length,e.UNSIGNED_SHORT,0,this.DISC_INSTANCE_COUNT),e.bindVertexArray(null)}updateCameraMatrix(){Q(this.camera.matrix,this.camera.position,[0,0,0],this.camera.up),$(this.camera.matrices.view,this.camera.matrix)}updateProjectionMatrix(){if(!this.gl)return;const e=this.gl.canvas;this.camera.aspect=e.clientWidth/e.clientHeight;const i=this.SPHERE_RADIUS*.35,r=this.camera.position[2];this.camera.aspect>1?this.camera.fov=2*Math.atan(i/r):this.camera.fov=2*Math.atan(i/this.camera.aspect/r),ct(this.camera.matrices.projection,this.camera.fov,this.camera.aspect,this.camera.near,this.camera.far),$(this.camera.matrices.inversProjection,this.camera.matrices.projection)}onControlUpdate(e){const i=e/this.TARGET_FRAME_DURATION+1e-4;let r=5/i,n=3;const s=this.control.isPointerDown||Math.abs(this.smoothRotationVelocity)>.01;if(s!==this.movementActive&&(this.movementActive=s,this.onMovementChange(s)),this.control.isPointerDown)n+=this.control.rotationVelocity*80+2.5,r=7/i;else{const a=this.findNearestVertexIndex(),o=a%Math.max(1,this.items.length);this.onActiveItemChange(o);const c=D(M(),this.getVertexWorldPosition(a));this.control.snapTargetDirection=c}this.camera.position[2]+=(n-this.camera.position[2])/r,this.updateCameraMatrix()}findNearestVertexIndex(){const e=this.control.snapDirection,i=pt(y(),this.control.orientation),r=k(M(),e,i);let n=-1,s=0;for(let a=0;a<this.instancePositions.length;++a){const o=X(r,this.instancePositions[a]);o>n&&(n=o,s=a)}return s}getVertexWorldPosition(e){const i=this.instancePositions[e];return k(M(),i,this.control.orientation)}}const Ct=[{image:"https://picsum.photos/900/900?grayscale",link:"https://google.com/",title:"",description:""}],Lt=({items:t=[]})=>{const e=O.useRef(null),[i,r]=O.useState(null),[n,s]=O.useState(!1);O.useEffect(()=>{const o=e.current;let c=null;const h=f=>{if(!t.length)return;const d=f%t.length;r(t[d])};o&&(c=new Nt(o,t.length?t:Ct,h,s,f=>f.run()));const l=()=>{c&&c.resize()};return window.addEventListener("resize",l),l(),()=>{window.removeEventListener("resize",l)}},[t]);const a=()=>{i?.link&&(i.link.startsWith("http")?window.open(i.link,"_blank"):console.log("Internal route:",i.link))};return b.jsxs("div",{className:"relative w-full h-full text-white",children:[b.jsx("canvas",{id:"infinite-grid-menu-canvas",ref:e,className:"cursor-grab w-full h-full overflow-hidden relative outline-none active:cursor-grabbing"}),i&&b.jsxs(b.Fragment,{children:[b.jsx("h2",{className:`
          select-none
          absolute
          font-black
          [font-size:4rem]
          left-[50%]
          top-[10%]
          -translate-x-1/2
          xl:left-[10%]
          xl:top-1/2
          xl:-translate-x-0
          transform
          -translate-y-1/2
          w-full
          px-4
          text-center
          xl:text-left
          leading-tight
          text-white
          [text-shadow:_-2px_-2px_0_#000,_2px_-2px_0_#000,_-2px_2px_0_#000,_2px_2px_0_#000,_-1px_-1px_0_#000,_1px_-1px_0_#000,_-1px_1px_0_#000,_1px_1px_0_#000,_0_-2px_0_#000,_0_2px_0_#000,_-2px_0_0_#000,_2px_0_0_#000,_0_0_4px_rgba(0,0,0,0.8),_-3px_-3px_6px_rgba(0,0,0,0.6),_3px_-3px_6px_rgba(0,0,0,0.6),_-3px_3px_6px_rgba(0,0,0,0.6),_3px_3px_6px_rgba(0,0,0,0.6)]
          transition-all
          ease-[cubic-bezier(0.25,0.1,0.25,1.0)]
          ${n?"opacity-0 pointer-events-none duration-[100ms]":"opacity-100 pointer-events-auto duration-[500ms]"}
        `,children:i.title}),b.jsx("p",{className:`
          select-none
          absolute
          max-w-[10ch]
          text-[1.5rem]
          top-1/2
          right-[10%]
          lg:right-[15%]
          transform
          -translate-x-1/2
          text-white
          [text-shadow:_-1px_-1px_0_#000,_1px_-1px_0_#000,_-1px_1px_0_#000,_1px_1px_0_#000,_0_-1px_0_#000,_0_1px_0_#000,_-1px_0_0_#000,_1px_0_0_#000,_0_0_3px_rgba(0,0,0,0.8),_-2px_-2px_4px_rgba(0,0,0,0.6),_2px_-2px_4px_rgba(0,0,0,0.6),_-2px_2px_4px_rgba(0,0,0,0.6),_2px_2px_4px_rgba(0,0,0,0.6)]
          leading-tight
          transition-all
          ease-[cubic-bezier(0.25,0.1,0.25,1.0)]
          ${n?"opacity-0 pointer-events-none duration-[100ms] translate-x-[-60%] -translate-y-1/2":"opacity-100 pointer-events-auto duration-[500ms] translate-x-[-60%] -translate-y-1/2"}
        `,children:i.description}),b.jsx("div",{onClick:a,className:`
          absolute
          left-1/2
          z-10
          w-[60px]
          h-[60px]
          grid
          place-items-center
          bg-[#00ffff]
          border-[5px]
          border-black
          rounded-full
          cursor-pointer
          transition-all
          ease-[cubic-bezier(0.25,0.1,0.25,1.0)]
          ${n?"bottom-[-80px] opacity-0 pointer-events-none duration-[100ms] scale-0 -translate-x-1/2":"bottom-[3.8em] opacity-100 pointer-events-auto duration-[500ms] scale-100 -translate-x-1/2"}
        `,children:b.jsx("p",{className:"select-none relative text-[#060010] top-[2px] text-[26px]",children:"â†—"})})]})]})};function Gt(){const t=i=>`/me/${i}`,e=[{image:t("sundial-logo.svg"),link:"https://sundialprotocol.com/",title:"Sundial",description:"Core Tech Lead"},{image:t("ascent-logo.png"),link:"https://ascentrivals.com/",title:"Ascent Rivals",description:"Web & Smart Contract Engineer"},{image:t("grabbit-logo.svg"),link:"https://grabbit.market",title:"Grabbit Market",description:"Founder & Principal Engineer"},{image:t("paratext.webp"),link:"https://paratext.org/",title:"Paratext",description:"Software Developer"},{image:t("flex.webp"),link:"https://software.sil.org/fieldworks/",title:"FieldWorks",description:"Software Developer"}];return b.jsx("div",{className:"h-[calc(100vh-80px)]",children:b.jsx(Lt,{items:e})})}export{Gt as component};
